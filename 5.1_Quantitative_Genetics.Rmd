# Quantitative Genetics



\[
\sigma_P^2 = \sigma_G^2 + \sigma_E^2 + \sigma_{GxE}^2 
\]

\[
\sigma_G^2 =\sigma_A^2 + \sigma_D^2 + \sigma_I^2 
\]







## Data Examples

Here we will use some example data that was collected to understand the quantitative consequences of urban cultivar gene escape on native populations in the tree *Cornus florida*.  This species is widley distributed in natural populations throughout forests of easter North America.  It has also been artifically selected to express traits that make it suitable for use in the cultivar trade by nurseries.  Cultivar types can easily thrive in open sunlight (as is often found in residental yards, etc), whereas the native variants are typically typically found in more shaded areas of the forest understory.

An experiment was set up to collect arrays of seedling siblings from maternal individuals in both the urban environment and proximate native populations.  These seeds were germinated and grown in a greenhouse environment. Seedlings were then randomly assigned to either a full light (to mimic the urban environment) or a shaded (to represent the native understory) environment.  Several quantiative measurements were collected throughout the growning season.  A subset of these data are available in the <tt>seedlings.rda</tt> data file.


![Dogwood seedlings growing in the greenhouse.  Seeds were collected from parental trees from urban (left) and natural (right) populations and grown in either full light (to mimic urban environments) and shaded (to mimic native popualtions)](./media/seedlings.png)

```{r echo=FALSE}
load("media/seedlings.rda")
t <- table( seedlings$Source, seedlings$Mom)
df <- as.data.frame( t(t) )
df <- df[ !df$Freq == 0,]
```

The data presented represent the seedlings that had survived to the end of the growing season, partitioned by seed source.  A summary of the data is listed below.

Source | Treatment | Number of Trees | Offspring
-------|:----------|:---------------:|:----------:
fan    | Cultivar  | 24              | 131
rice   | Native    | 9               | 40

Quantitative measurements were made on each seedling throughout the growing season to determine if cultivar types were producing different phenotypes than native stock.  Some of the measured traits include:

- Cold - The length of time (in days) that the seedling remained dormant after cold stratification.
- Branches - The number of branching stems on each seedling.
- Leaves - The total number of leaves on the seedling.  
- Height - Total seedling height.
- Leaf Area - The size of the largest leaf on the seedling.

```{r}
summary(seedlings)
```

The relationship among these traits are presented below.

```{r message=FALSE, warning=FALSE}
library(GGally)
library(ggplot2)
ggpairs( seedlings, columns=4:8)
```

### Measured Traits

Visual summaries of the measured traits are shown below.  

```{r fig.cap="Length of time (in days) of seedling dormancy following cold stratification for seedlings collected from maternal trees in urban (fan) and native (rice) populations."}
p <- ggplot(seedlings) + theme_bw()
p + geom_density( aes(fill=Source,x=Cold), alpha=0.75)
```

In the remaining plot, I partion the display of phenotypic variability further by separating out seedlings that were grown in either the SUN (full light) or SHADE (reduced light) treatments.

```{r fig.cap="The height of the seedling measured from the soil to the top of the apical meristem."}
p <- p + facet_grid(Treatment~.)
p + geom_density( aes(fill=Source,x=Height), alpha=0.75) 
```

```{r fig.cap="The number of branches from the main seedling stem."}
p + geom_density( aes(fill=Source,x=Branches), alpha=0.75) 
```

```{r fig.cap="The photosynthetic area measured on the largest leaf from each seedling."}
p + geom_density( aes(fill=Source,x=LeafArea), alpha=0.75) 
```

```{r fig.cap="The total number of leaves on the seedling."}
geom_density( aes(fill=Source,x=Leaves), alpha=0.75)
```

Overall, there are noticable differences in phenotypes due to both `Source` and `Treatment` as well as some pronounced bi-modality in the data.


## Heritability

Heritability can be estimated at two different levels of specificity.  Broad sense heritability ($H^2$) is the proportion of the phenotypic variance that can be attribted to genetic variance.

\[
H^2 = \frac{\sigma_G^2}{\sigma_P^2}
\]

This estimate includes the additive ($\sigma_A^2$), dominance ($\sigma_D^2$), and interaction ($\sigma_I^2$) variance and is the easiest parameter to estimate.  A common approach to estimating $H^2$ is to report it as the proportion of variance explained ($R^2$) from an ANOVA based upon family-level data.  Often we treat the family unit as a random effect in an analysis of variance.  In `R` we fit random effects models using the `lmer` function.

```{r warning=FALSE, message=FALSE}
library(lme4)
h2.cold <- lmer(Cold ~ (1|Mom), data=seedlings)
summary(h2.cold)
```

If you are not familiar with fitting a random effect to a model in R, this may look a bit odd.  The formula `Cold ~ (1|Mom)` is examining differences among the length of dormancy as explained by seedlings grouped by mother.  The maternal stratum is treated as a random effect because we are assuming that the mothers we used are a random selection from a much broader population of mothers.  The differences between a random and a fixed effects model is in how we estimate the variance components.  In a fixed effect model, the expectation for the treatment variance is based solely upon the treatment effect $E[\sigma_A^2] = \frac{MSA}$.  However, in a random effects model, we assume that since we are sampling on a random subsample of potential mothers, the treatment effect is a bit upwardly biased and we need to correct that variance.  

Here is an example of how those differ.  Treating mother as a fixed effect, we can see the estimates of the varince for both Mom and Residuals as the values int he third column.

```{r}
anova( aov(Cold~Mom,data=seedlings))
```

However, those same variance estiamtes, assuming that Mom is a random effect, are different (moreso for the Mom effect than that for the Residual variance).

```{r}
print(VarCorr(h2.cold), comp="Variance")
```

Then from the formula above, we can estimate the fraction of the total variance that is attributed to the family effect as:

```{r}
sigmas <- as.data.frame( VarCorr( h2.cold) )$vcov
H2 <- sigmas[1] / sum( sigmas )
H2
```

This result shows suggests that roughly `r round(H2*100,digits=2)`% of the variation can be attributed to genetic effects.



Narrow-sense heritabilty is a bit more precise in that it uses not the total genetic variance but only that associated with the additive component of variation.  

\[
h^2 = \frac{\sigma_A^2}{\sigma_P^2}
\]

However, this precision is gained at the expense of a bit more complexity.  There are a few different basic methods used for estimating $h^2$ from sibling data.

1. Twin studies.  If you have data from monozygotic (MZ) and dizygotic (DZ) twins, the narrow sense heritability can be estimated using the differenes in phenotypic correlations, $h^2 = r_{MZ} - r_{DZ}$ (the so-called Falconer's Formula).  Jaccard (1983) had suggested a modification of this to use $h^2 = (r_{MZ} - r_{DZ})/(1-r_{DZ})$ instead though it is not that common of a standardization.  
2. Another method that can be used relies upon estimates of consanguanity (e.g., genetic relatedness) of the siblings.  In most organisms, this would be a value that is relatively easy to calculate---they are half sibs because we collected them from the same maternal individual!  However, in many plants it is not uncommon to have mixes of full and half siblings due to selfing as well as have correlated paternity (e.g., two seeds are actually full siblings since they share the same fater as well as mother).  Without a little more genetic information on these individuals we cannot determine either of these parameters.
3. The final method uses both parent and offspring phenotypes.  Here, narrow sense heritabilty is the slope of a regression line fitting offspring phenotype to the average of the parental phenotype.  If heritabilty is high, then the slope of this line will approach 1.0, whereas if offspring phenotypes have little relation to those measured on the parents (e.g., $\sigma_E^2$ and perhaps $\sigma_{GxE}^2$ have more influence) then the slope will tend towards zero.  There is a caveat here in that when a trait has a low heritability (e.g., the slope is close to zero), it is often the case that the variation explained by that model (the $R^2$) is also low.  Conversely, when heritability is high, it is often the case that $R^2$ is also increased.  This means that the power of this kind of anlaysis improves with heritability in that we get a better estimate when it is high.

You can easily find examples of each of these methods in the literature.  However, in landscape studies, we often lack the kind of information necessary to collect these data, which is why understanding quantitative genetics in natural populations is a challenging endeavour.  

## Questions

1. For many quatitative traits, environmental variance ($\sigma_E^2$) may make large contributions to observed phenotypic variance.  From the traits above, which show the largest environmental effects (e.g., `SHADE` vs `SUN`)?  

```{r echo=FALSE, eval=FALSE}
The branches trait seems to be the most influenced by SHADE vs. SUN.  There is very little variance in the SHADE treatment but there is a broad range of values for the SUN one.
```


2. What is the broad-sense heritability for the remaining traits in the `SHADE` treatment?  Are they similar or different?  Explain the results.

```{r eval=FALSE, echo=FALSE}

```


3. Estimate broad-sense heritability for the `SUN` families.  How do these differ from the estimates of heritability in the `SHADE` seedlings?

```{r eval=FALSE, echo=FALSE}

```


4. Assuming that the dominance and interaction variance ($\sigma_D^2$ and $\sigma_I^2$) of these traits were constant (e.g., $H^2$ would be proportional to $h^2$), rank the traits in terms of their ability to respond to selection.  Which are able to respond faster?  

```{r eval=FALSE, echo=FALSE}
Traits with the largest heritability will be the ones that respond the quickest to any type of selection, assuming that the strength of selection (e.g., the mean value of the parents relative to that of the population they are drawn from) is the same.
```


